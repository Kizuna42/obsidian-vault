# 言語ごとの翻訳データの管理 (1)

## **1. next-translateとは？**

next-translateは軽量かつ柔軟な国際化ライブラリです。

設定がシンプルで、next-i18nextと比較して扱いやすいのが特徴です。

---

## **2. インストール**

```bash
npm install next-translate

```

---

## **3. 設定**

### **3-1. プロジェクトルートに`i18n.json`を作成**

以下の内容を記述します：

```json
{
  "locales": ["en", "ja", "fr"],
  "defaultLocale": "en",
  "pages": {
    "*": ["common"],
    "/about": ["about"]
  }
}

```

### **3-2. 翻訳ファイルを作成**

各言語の翻訳ファイルを`locales`ディレクトリ内に作成します。

### **ディレクトリ構造**

```
/locales
  /en
    common.json
    about.json
  /ja
    common.json
    about.json
```

### **例: `locales/ja/common.json`**

```json
{
  "welcome": "ようこそ",
  "description": "これは多言語対応のウェブサイトです。"
}
```

---

## **4. 翻訳の利用**

### **コンポーネントで翻訳を使用する**

以下のコード例のように、`useTranslation`フックを使って翻訳データを取得できます。

```jsx
import useTranslation from 'next-translate/useTranslation';

export default function Home() {
  const { t } = useTranslation('common');

  return (
    <div>
      <h1>{t('welcome')}</h1>
      <p>{t('description')}</p>
    </div>
  );
}
```

---

このように、必要な設定を進めることで、シンプルに多言語対応を実現できます✨

### **多言語対応アプリの実装手順 (next-translate + Contextを利用)**

---

### **1. Contextでロケール状態を管理**

`LocaleContext`を作成して、アプリ全体でロケールを管理します。

```tsx
// context/LocaleContext.tsx
import React, { createContext, useContext, useState } from 'react';
import { useRouter } from 'next/router';

interface LocaleContextProps {
  locale: string;
  setLocale: (locale: string) => void;
}

const LocaleContext = createContext<LocaleContextProps | undefined>(undefined);

export const LocaleProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { locale: routerLocale, push, pathname, query, asPath } = useRouter();
  const [locale, setLocale] = useState(routerLocale || 'en');

  const changeLocale = (newLocale: string) => {
    setLocale(newLocale);
    push({ pathname, query }, asPath, { locale: newLocale });
  };

  return (
    <LocaleContext.Provider value={{ locale, setLocale: changeLocale }}>
      {children}
    </LocaleContext.Provider>
  );
};

export const useLocale = (): LocaleContextProps => {
  const context = useContext(LocaleContext);
  if (!context) {
    throw new Error('useLocale must be used within a LocaleProvider');
  }
  return context;
};

```

---

### **2. Providerをアプリ全体に適用**

`_app.tsx`で`LocaleProvider`をラップします。

```tsx
// pages/_app.tsx
import { LocaleProvider } from '../context/LocaleContext';
import '../styles/globals.css';

function MyApp({ Component, pageProps }: any) {
  return (
    <LocaleProvider>
      <Component {...pageProps} />
    </Localrovider>
  );
}

export default MyApp;

```

---

### **3. ロケール切り替え用コンポーネント**

`useLocale`を使用して、ユーザーがロケールを切り替えるUIを作成します。

```tsx
// components/LocaleSwitcher.tsx
import { useLocale } from '../context/LocaleContext';

export default function LocaleSwitcher() {
  const { locale, setLocale } = useLocale();

  return (
    <select value={locale} onChange={(e) => setLocale(e.target.value)}>
      <option value="en">English</option>
      <option value="ja">日本語</option>
      <option value="fr">Français</option>
    </select>
  );
}

```

---

### **4. 翻訳を利用したコンポーネント**

`next-translate`の`useTranslation`フックを使い、選択されたロケールに応じた翻訳をレンダリングします。

```tsx
// pages/index.tsx
import useTranslation from 'next-translate/useTranslation';
import LocaleSwitcher from '../components/LocaleSwitcher';

export default function Home() {
  const { t } = useTranslation('common');

  return (
    <div>
      <LocaleSwitcher />
      <h1>{t('welcome')}</h1>
      <p>{t('description')}</p>
    </div>
  );
}

```

---

### **5. ルートとロケール設定**

Next.jsの仕組みで、ルートに応じたロケールをサポートします。

- `/` → デフォルトロケール（例: **en**）
- `/ja` → 日本語
- `/fr` → フランス語

---

### **6. 動作の流れ**

1. ユーザーがドロップダウンメニューでロケールを選択。
2. `LocaleContext`が`setLocale`を介して状態を更新。
3. `next/router`の`push`でURLが更新される。
4. URLに基づいて対応する翻訳ファイルがロードされ、コンポーネントが再レンダリングされる。

---

### **概要**

- **柔軟性:** Contextでロケール状態を管理することで、アプリ全体でロケール情報を簡単に共有。
- **利便性:** URLにロケールが反映されるため、直接リンクを共有しても正しい翻訳が表示される。
- **拡張性:** 他の機能（例: ロケールごとのスタイル変更）との連携が容易。

---

**参考:**

- **`next-translate`**: 翻訳を効率的に管理するNext.js専用ライブラリ。
- **Context API**: 状態管理を簡潔に実現するReactの仕組み。